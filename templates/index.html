<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>LabCam Profiler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="layout">
    <!-- Left Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-inner">
        <h1 class="app-title">LabCam Profiler</h1>

        <section class="panel">
          <h2>Camera</h2>
          <label class="row space">
            <span>Camera</span>
            <select id="cameraSelect" style="flex-grow: 1;"></select>
          </label>
          <label class="row space">
            <span>Enabled</span>
            <input id="cameraToggle" type="checkbox" />
          </label>
        <label class="row space">
          <span>Background Subtraction</span>
          <input id="backgroundSubtractionToggle" type="checkbox" />
        </label>
      </section>

      <section class="panel">
        <h2>Data Export</h2>
        <button id="saveAllBtn" class="primary">Save All</button>
      </section>

        <section class="panel">
          <h2>Exposure (Âµs)</h2>
          <div class="row space">
            <input id="expSlider" type="range" min="1000" max="50000" step="1000" />
            <span id="expLabel" class="mono">-</span>
          </div>
        </section>

        <section class="panel">
          <h2>Colormap</h2>
          <select id="colormapSelect">
            <option value="grey">grey</option>
            <option value="jet">jet</option>
            <option value="cubiczero">cubiczero</option>
          </select>
        </section>

        <section class="panel">
          <h2>Beam Analysis</h2>
          <label class="row space">
            <span>Pixel size</span>
            <input id="baPixelSize" type="number" step="any" placeholder="e.g. 3.45" style="width:120px;" />
          </label>
          <label class="row space">
            <span>Compute</span>
            <select id="baCompute" style="flex-grow:1;">
              <option value="both">both</option>
              <option value="second">second</option>
              <option value="gauss">gauss</option>
              <option value="none">none</option>
            </select>
          </label>
          <label class="row space">
            <span>Clip negatives</span>
            <select id="baClipNegatives" style="flex-grow:1;">
              <option value="none">none</option>
              <option value="zero">zero</option>
              <option value="otsu">otsu</option>
            </select>
          </label>
          <label class="row space">
            <span>Angle clip mode</span>
            <select id="baAngleClip" style="flex-grow:1;">
              <option value="same">same</option>
              <option value="none">none</option>
              <option value="zero">zero</option>
              <option value="otsu">otsu</option>
            </select>
          </label>
          <label class="row space">
            <span>Background subtraction</span>
            <input id="baBackground" type="checkbox" />
          </label>
          <label class="row space">
            <span>Rotation</span>
            <select id="baRotation" style="flex-grow:1;">
              <option value="auto">auto</option>
              <option value="fixed">fixed</option>
            </select>
          </label>
          <label class="row space">
            <span>Fixed angle (deg)</span>
            <input id="baFixedAngle" type="number" step="any" placeholder="0.0" style="width:120px;" />
          </label>
        </section>

        <section class="panel">
          <h2>ROIs</h2>
          <div id="roiHint" class="hint">Add by dragging on the live view. Drag to move. Resize using handles.</div>
          <div id="roiList" class="roi-list"></div>
        </section>
      </div>
    </aside>

    <!-- Right Workspace -->
    <main class="workspace">
      <!-- Live View -->
      <section class="work-panel">
        <div class="panel-header">
          <h2>Live View</h2>
          <div class="stats mono">
            <span id="statsExposure">exp: -</span>
            <span id="statsFps">fps: -</span>
          </div>
        </div>
        <div id="liveContainer" class="live-container">
          <img id="stream" alt="Stream" src="/video_feed" />
          <canvas id="roiOverlay"></canvas>
        </div>
      </section>


      <!-- ROI Streams Grid -->
      <section id="roiGridPanel" class="work-panel" hidden>
        <div class="panel-header">
          <h2>ROI Streams</h2>
        </div>
        <div id="roiGrid" class="roi-grid"></div>
      </section>

      <!-- Per-ROI Panels -->
      <section id="perRoiPanels" class="work-panel" hidden>
        <div class="panel-header">
          <h2>Per-ROI Panels</h2>
        </div>
        <div id="perRoiGrid" class="per-roi-grid">
          <!-- JS will populate this -->
        </div>
      </section>
    </main>
  </div>

  <script defer src="{{ url_for('static', filename='app.js') }}"></script>

  <div id="backgroundSubtractionModal" class="modal" hidden>
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2>Background Subtraction</h2>
      <p>Please block the beam to capture the background. The application will capture a number of frames and average them to create a background image that will be subtracted from all subsequent frames.</p>
      <label for="numFrames">Number of frames to average:</label>
      <input type="number" id="numFrames" name="numFrames" value="10" min="1">
      <button id="startBgSubtraction" class="primary">Start</button>
    </div>
  </div>
</body>
</html>
